#:kivy 1.6.0

WindowManager:
    id:wm
	FirstWindow:
	SecondWindow:


<FirstWindow>:
	name: "first"
    id:first   
    Widget:
        Image:
            source:"FIUNA.png"
            fit_mode: "contain"
            pos: root.width *0.82,root.height*0.7
            size: root.width *0.2,root.height*0.2
    Label:
        text: "Página\nPrincipal"
        size_hint: .1,.1
        pos_hint: {"right":.9,"bottom":1}
    Button:
        size_hint: .1,.1
        pos_hint: {"right":1,"bottom":1}
        text: "Cámara"
        #font_size: 16
        on_release: 
            app.root.current = "second"
            root.manager.transition.direction = "left"
    Button:
        pos_hint:{"right":1,"top":0.2}
        size_hint: .1,.1
        text: "Borrar\nGráfico"
        on_press:app.borrarGrafico()
    # Label:
    #     text: "Frecuencia\nDominante:\n"+str(app.frecD)+"Hz"
    #     size_hint: .2,.1
    #     pos_hint: {"right":1,"top":.5}
    Label:
        text: "Rango Hembras: "+["No","Si"][app.rangoH]+"\nRango Machos: "+["No","Si"][app.rangoM]
        size_hint: .2,.1
        pos_hint: {"right":1,"top":.5}
    # Button:
    #     text: "Tipo de Gráfico:\n"+["Normal","Espectrograma 1","Espectrograma 2"][app.tipoDeGrafico]
    #     size_hint: .2,.1
    #     pos_hint: {"right":1,"top":.6}
    #     disabled:not app.modoManual
    #     on_press:app.tipoDeGrafico=(app.tipoDeGrafico+1)%3
    Button:
        text: "Agitar Mosquitos"
        size_hint: .2,.1
        pos_hint: {"right":1,"top":.6}
        disabled:not app.modoManual or app.ocupado or not app.pCorriendo
        on_press: 
            if app.pCorriendo: app.qSal.put("Agitar")
            if app.pCorriendo: app.ocupado=True
    
    Button: #cerrar interfaz
        size_hint: .245,.125
        pos_hint: {"center_x":0.125,"center_y":0.875}
        text: "Cerrar Interfaz"
        on_press:app.stop()

    Button: #iniciar/cerrar script
        size_hint: .245,.125
        pos_hint: {"center_x":0.375,"center_y":0.875}
        text: app.botonScript 
        on_press: 
            app.iniciarPrograma()

    Button: #selector de modo manual y automatico
        size_hint: .245,.125
        pos_hint: {"center_x":0.375,"center_y":0.75}
        text: ["Modo Automatico","Modo Manual"][app.modoManual]
        disabled: app.ocupado
        on_press: 
            app.modoManual=not app.modoManual
            if app.pCorriendo:app.qSal.put(self.text)
            if not app.modoManual:app.tipoDeGrafico=0
    

    Label: #para mostrar errores
        size_hint: .245,.125
        pos_hint: {"center_x":0.125,"center_y":0.74}
        text:app.error
          
    Button: 
        size_hint: .245,.0625
        pos_hint: {"center_x":0.125,"center_y":0.65625}
        disabled:not app.modoManual or not app.pCorriendo or app.ocupado
        text: "Detectar Mosquito"
        on_press: 
            if app.pCorriendo: app.qSal.put("Posicion Inicial")
            if app.pCorriendo: app.ocupado=True
    Button: 
        size_hint: .2,.1
        pos_hint: {"right":1,"top":.4}
        disabled:not app.modoManual or not app.pCorriendo or app.ocupado
        text: "Grabar Audio"
        on_press:
            if app.pCorriendo: app.qSal.put(["Grabar Audio","Espectrograma","Espectrograma"][app.tipoDeGrafico])
            if app.pCorriendo: app.ocupado=True
    Button:
        size_hint: .245,.0625
        pos_hint: {"center_x":0.375,"center_y":0.65625}
        disabled:not app.modoManual or not app.pCorriendo or app.ocupado
        text: "Medir Frecuencia (Luz)"
        on_press:
            if app.pCorriendo: app.qSal.put("ADC")
            if app.pCorriendo: app.ocupado=True
    Button: 
        size_hint: .245,.0625
        pos_hint: {"center_x":0.625,"center_y":0.65625}
        text: ["Activar cámara","Apagar cámara"][app.video]
        disabled:not app.modoManual or not app.pCorriendo or (app.ocupado and not app.video)
        on_press: 
            if app.pCorriendo and not app.video: app.qSal.put("video")
            if app.pCorriendo and not app.video: app.ocupado=True
            elif app.pCorriendo and app.video: app.qSal.put("pararVideo")
    Button: 
        size_hint: .245,.0625
        pos_hint: {"center_x":0.875,"center_y":0.65625}
        disabled:not app.modoManual or not app.pCorriendo or app.ocupado
        text: "Soltar Mosquito"
        on_press: 
            if app.pCorriendo:app.qSal.put("Soltar Mosquito")   
            if app.pCorriendo:app.ocupado=True


    Label:
        size_hint: .125/2,.125
        pos_hint: {"right":0.25,"top":1.025}
        text: 'Cant. de cada grupo de mosquitos:'
    Label:
        size_hint: .125/2,.125
        pos_hint: {"right":0.25/2+0.45,"top":1.025}
        text: 'Machos: '+ str(app.contM)
    Label:
        size_hint: .125/2,.125
        pos_hint: {"right":0.75/2+0.45,"top":1.025}
        text: 'Hembras: '+str(app.contH)
    Label:
        size_hint: .125/2,.125
        pos_hint: {"right":0.25+0.45,"top":1.025}
        text: 'Mixto: '+ str(app.contMix)
    Label:
        size_hint: .125/2,.125
        pos_hint: {"right":0.50+0.45,"top":1.025}
        text: 'Nada: '+str(app.contNada)
    
    # Para mostrar el estado actual
    Label:    
        size_hint: .49,.125
        pos_hint: {"center_x":0.75,"center_y":0.75}
        text: app.estado
        #on_press: app.funcPrueba()
        #on_release:app.graficar()
        #on_state:app.graficar()
    Label:  
        size_hint: .49,.125
        pos_hint: {"center_x":0.75,"center_y":0.875}
        text: "Estado de la trampa"


<SecondWindow>:
	name: "second"
    Widget:
        Image:
            source:"FIUNA.png"
            fit_mode: "contain"
            pos: root.width *0.8825,root.height*0.1
            size: root.width *0.135,root.height*0.135
    Label:
        text: "Cámara"
        size_hint: .1,.1
        pos_hint: {"right":.9,"bottom":1}
    Button:
        size_hint: .1,.1
        pos_hint: {"right":1,"bottom":1}
        text: "Página\nPrincipal"
        on_release: 
            app.root.current = "first"
            root.manager.transition.direction = "right"
    
    Button:
        pos_hint:{"right":1,"top":1}
        size_hint: .1,.1
        text: ["Activar\ncámara","Apagar\ncámara"][app.video]
        disabled:not app.modoManual or not app.pCorriendo or (app.ocupado and not app.video)
        on_press: 
            if app.pCorriendo and not app.video: app.qSal.put("video")
            if app.pCorriendo and not app.video: app.ocupado=True
            elif app.pCorriendo and app.video: app.qSal.put("pararVideo")
            #app.videoCapture() 

    Button:
        pos_hint:{"right":1,"top":0.8}
        size_hint: .1,.1
        text: "Sacar Foto"
        disabled:not app.video or app.grabando
        on_press: 
            app.foto=True
    
    Button:
        pos_hint:{"right":1,"top":0.9}
        size_hint: .1,.1
        text:  ["Grabar","Terminar"][app.grabando]
        disabled:not app.video or app.foto
        on_press: 
            if not app.grabando:app.grabarVideo()
            else : app.pararGrabacion()
    
    Button:
        pos_hint:{"right":1,"top":0.7}
        size_hint: .1,.1
        text: "Guardar"
        disabled:not app.foto
        on_press: 
            app.guardarImagen()

    Button:
        pos_hint:{"right":1,"top":0.6}
        size_hint: .1,.1
        text: "Descartar"
        disabled:not app.foto
        on_press: 
            app.foto=False

    Widget:
        Image:
            texture:app.texture
            fit_mode: "contain"
            pos: root.width *0.01,root.height*0.1
            size: root.width *0.89,root.height*0.89
